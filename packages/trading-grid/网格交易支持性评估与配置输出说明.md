# 网格交易支持性评估与配置输出说明

## 1. 输出结构概览

系统输入 **股票/标的代码（symbol）**，输出一个 JSON 对象，主要包含以下部分：

```json
{
  "symbol": "股票代码",
  "is_supported": true/false,
  "reason": {...},
  "grid_config": {...} | null,
  "meta": {...}
}
```

---

## 2. 字段说明

### 2.1 `symbol`

* 类型：`string`
* 说明：股票或标的的唯一代码（如 `"600519"`, `"AAPL"`）

---

### 2.2 `is_supported`

* 类型：`boolean`
* 说明：是否整体支持网格交易策略。

---

### 2.3 `reason`

* 类型：`object`
* 说明：多维度因子评估，建议按 **技术面 / 基本面 / 情绪面** 分类，便于扩展。

#### 结构示例：

```json
"reason": {
  "technical": [
    {
      "factor": "volatility",
      "name": "波动率",
      "value": 0.18,
      "threshold": "0.05 - 0.50",
      "conclusion": "适中，适合网格",
      "is_passed": true
    }
  ],
  "fundamental": [
    {
      "factor": "pe_ratio",
      "name": "市盈率",
      "value": 25,
      "threshold": "< 50",
      "conclusion": "估值合理",
      "is_passed": true
    }
  ],
  "sentiment": [
    {
      "factor": "news_sentiment",
      "name": "新闻情绪",
      "value": -0.3,
      "threshold": "> -0.5",
      "conclusion": "情绪偏负但可控",
      "is_passed": true
    }
  ]
}
```

#### 子字段定义

| 字段名          | 类型        | 说明                                                    |
| ------------ | --------- | ----------------------------------------------------- |
| `factor`     | string    | 英文因子名，便于程序识别（如 `"volatility"`, `"volume"`, `"trend"`） |
| `name`       | string    | 中文名称，便于展示                                             |
| `value`      | float/int | 实际计算出的指标值                                             |
| `threshold`  | string    | 判断阈值（范围或条件）                                           |
| `conclusion` | string    | 针对该因子的结论                                              |
| `is_passed`  | boolean   | 是否通过该因子的判断                                            |

---

### 2.4 `grid_config`

* 类型：`object | null`
* 说明：网格参数配置，仅在 `is_supported=true` 时输出；否则为 `null`。

#### 子字段定义

| 字段名                 | 类型     | 说明                                             |
| ------------------- | ------ | ---------------------------------------------- |
| `lower_bound`       | float  | 网格下边界价格                                        |
| `upper_bound`       | float  | 网格上边界价格                                        |
| `grid_count`        | int    | 网格层数                                           |
| `grid_spacing_mode` | string | 网格间距模式（如 `"FIXED_%"`, `"ATR_K"`, `"BBANDS_K"`） |
| `grid_spacing_pct`  | float  | 固定百分比间距（如 `1.5` 表示 1.5%）                       |
| `current_price`     | float  | 当前价格                                           |
| `grid_levels`       | array  | 各层网格的价格列表                                      |

---

### 2.5 `meta`

* 类型：`object`
* 说明：元信息，方便追踪与扩展。

#### 子字段定义

| 字段名                       | 类型     | 说明               |
| ------------------------- | ------ | ---------------- |
| `generated_at`            | string | 结果生成时间（ISO 日期格式） |
| `lookback_days`           | int    | 计算指标所用的历史天数      |
| `spacing_mode_candidates` | array  | 可选的网格间距计算方式      |

---

## 3. 示例输出

### 3.1 支持网格交易

```json
{
  "symbol": "600519",
  "is_supported": true,
  "reason": {
    "technical": [
      {
        "factor": "volatility",
        "name": "波动率",
        "value": 0.18,
        "threshold": "0.05 - 0.50",
        "conclusion": "适中，适合网格",
        "is_passed": true
      },
      {
        "factor": "volume",
        "name": "平均成交量",
        "value": 1200000,
        "threshold": "> 1000000",
        "conclusion": "成交量充足",
        "is_passed": true
      }
    ],
    "fundamental": [
      {
        "factor": "pe_ratio",
        "name": "市盈率",
        "value": 25,
        "threshold": "< 50",
        "conclusion": "估值合理",
        "is_passed": true
      }
    ],
    "sentiment": [
      {
        "factor": "news_sentiment",
        "name": "新闻情绪",
        "value": 0.2,
        "threshold": "> -0.5",
        "conclusion": "市场情绪稳定",
        "is_passed": true
      }
    ]
  },
  "grid_config": {
    "lower_bound": 1450.0,
    "upper_bound": 1780.0,
    "grid_count": 20,
    "grid_spacing_mode": "FIXED_%",
    "grid_spacing_pct": 1.5,
    "current_price": 1602.0,
    "grid_levels": [1450.0, 1472.9, 1496.1, ...]
  },
  "meta": {
    "generated_at": "2025-09-09",
    "lookback_days": 180,
    "spacing_mode_candidates": ["FIXED_%", "ATR_K", "BBANDS_K"]
  }
}
```

---

### 3.2 不支持网格交易

```json
{
  "symbol": "000001",
  "is_supported": false,
  "reason": {
    "technical": [
      {
        "factor": "volatility",
        "name": "波动率",
        "value": 0.02,
        "threshold": "0.05 - 0.50",
        "conclusion": "波动率过低，不适合网格",
        "is_passed": false
      },
      {
        "factor": "volume",
        "name": "平均成交量",
        "value": 300000,
        "threshold": "> 1000000",
        "conclusion": "成交量不足，流动性差",
        "is_passed": false
      }
    ],
    "fundamental": [
      {
        "factor": "pe_ratio",
        "name": "市盈率",
        "value": 120,
        "threshold": "< 50",
        "conclusion": "估值过高",
        "is_passed": false
      }
    ],
    "sentiment": [
      {
        "factor": "news_sentiment",
        "name": "新闻情绪",
        "value": -0.8,
        "threshold": "> -0.5",
        "conclusion": "市场情绪过度悲观",
        "is_passed": false
      }
    ]
  },
  "grid_config": null,
  "meta": {
    "generated_at": "2025-09-09",
    "lookback_days": 180,
    "spacing_mode_candidates": ["FIXED_%", "ATR_K", "BBANDS_K"]
  }
}
```

---

## 4. 扩展性设计

1. **因子可扩展**

   * 技术面：波动率、成交量、趋势、ATR、布林带宽度
   * 基本面：市盈率、市净率、ROE、行业地位
   * 情绪面：新闻情绪、社交媒体热度、资金流向

2. **因子分组**
   使用 `reason.technical / fundamental / sentiment` 三个维度，便于扩展更多维度（如 `macro` 宏观面）。

3. **is\_passed 标准化**
   每个因子均提供 `is_passed: true/false`，便于后续系统聚合判断是否整体 `is_supported=true`。

4. **风险提示**
   可以在 `conclusion` 增加风控建议：

   * `"波动率偏高，建议减少仓位"`
   * `"成交量不足，风险较大，不建议网格"`

